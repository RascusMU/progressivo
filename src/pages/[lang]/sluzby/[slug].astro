---
import { getCollection, render } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';

export async function getStaticPaths() {
  const services = await getCollection('services');

  // Including 'cs' here to support /cs/sluzby/ URLs as requested
  const languages = ['cs', 'en', 'de', 'ru', 'es'];
  const paths = [];

  for (const service of services) {
    const id = service.id;
    const parts = id.split('/');

    let lang, slug;

    // CS files are at the root of the collection (e.g. "analyza-dna.md")
    // Translated files are in folders (e.g. "en/analyza-dna.md")
    if (parts.length === 1) {
        lang = 'cs';
        slug = id.replace(/\.md$/, '');
    } else if (parts.length > 1 && languages.includes(parts[0])) {
        lang = parts[0];
        slug = parts.slice(1).join('/').replace(/\.md$/, '');
    } else {
        continue;
    }

    paths.push({
      params: { lang, slug },
      props: { service },
    });
  }

  return paths;
}

const { service } = Astro.props;
const { Content } = await render(service);
const { lang } = Astro.params;

// SCHEMA
const schemaService = {
  "@context": "https://schema.org",
  "@type": "Service",
  "name": service.data.title,
  "description": service.data.description,
  "provider": {
    "@type": "Organization",
    "name": "Progressivo",
    "url": "https://progressivo.eu"
  },
  "url": new URL(Astro.url.pathname, Astro.site).toString()
};
---

<Layout title={`${service.data.title} | Progressivo`} description={service.data.description} lang={lang} schema={schemaService}>
  <article class="container page-content animate-on-scroll">
    <div class="prose lg:prose-xl mx-auto">
        <Content />
    </div>
  </article>
</Layout>

<style>
  .page-content {
      padding-top: 8rem;
      padding-bottom: 4rem;
  }
</style>
