---
import Layout from '../layouts/Layout.astro';
import FounderAudioPlayer from '../components/FounderAudioPlayer.astro';
import { getCollection } from 'astro:content';

const allServices = await getCollection('services');
let services = allServices.filter(service => !['en/', 'de/', 'ru/', 'es/'].some(prefix => service.id.startsWith(prefix)));

const desiredOrder = [
  'analyza-dna',
  'efektivni-integrace',
  'it-podpora',
  'expatriace-viza',
  'nemovitosti',
  'preklady',
  'prodej-techniky',
  'online-kurzy'
];

services.sort((a, b) => {
  const slugA = a.id.replace(/\.md$/, '');
  const slugB = b.id.replace(/\.md$/, '');
  return desiredOrder.indexOf(slugA) - desiredOrder.indexOf(slugB);
});
---

<Layout title="Domů | Progressivo">
  <script>
    // Stats Animation
    const statsSection = document.querySelector('.stats-section');
    const stats = document.querySelectorAll('.stat-number');
    let started = false;

    function startCounting() {
      if (started) return;

      stats.forEach(stat => {
        const target = +stat.getAttribute('data-target');
        const duration = 2000; // 2 seconds
        const increment = target / (duration / 16); // 60fps

        let current = 0;
        const updateCount = () => {
          current += increment;
          if (current < target) {
            stat.innerText = Math.ceil(current) + (stat.nextElementSibling.innerText.includes('/7') && target === 24 ? '' : (target === 15 ? '+' : ''));
            requestAnimationFrame(updateCount);
          } else {
            stat.innerText = target + (target === 15 ? '+' : '');
          }
        };
        updateCount();
      });
      started = true;
    }

    if (statsSection) {
        const observer = new IntersectionObserver((entries) => {
            if (entries[0].isIntersecting) {
                startCounting();
            }
        }, { threshold: 0.5 });

        observer.observe(statsSection);
    }

  // 3D Tilt Effect
  const cards = document.querySelectorAll('.service-card');

  if (window.matchMedia("(min-width: 1024px)").matches) {
      cards.forEach(card => {
          card.addEventListener('mousemove', (e) => {
              // @ts-ignore
              const rect = card.getBoundingClientRect();
              // @ts-ignore
              const x = e.clientX - rect.left;
              // @ts-ignore
              const y = e.clientY - rect.top;

              const centerX = rect.width / 2;
              const centerY = rect.height / 2;

              const rotateX = ((y - centerY) / centerY) * -5; // Max 5 deg rotation
              const rotateY = ((x - centerX) / centerX) * 5;

              // @ts-ignore
              card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.02, 1.02, 1.02)`;
          });

          card.addEventListener('mouseleave', () => {
              // @ts-ignore
              card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale3d(1, 1, 1)';
          });
      });
  }
  </script>

  <!-- Hero Section -->
  <section class="hero animate-on-scroll">
    <div class="container hero-content">
      <h1>Překročte hranice s námi – propojujeme Evropu s celým světem</h1>
      <p class="subtitle">Moderní technika, vzdělání i DNA analýzy na jediné platformě.</p>
      <a href="#services" class="cta-button">Objevte naše služby</a>
    </div>
  </section>

  <!-- Founder Section -->
  <section id="founder" class="founder-section animate-on-scroll">
    <div class="container founder-content">
      <div class="founder-text">
        <h2 class="section-title-left">O zakladateli</h2>
        <p class="founder-bio">
          Jaroslav Cingel – Spojuji mezinárodní byznys se svobodou. 15+ let zkušeností v logistice, Panama & EU.
        </p>
        <a href="https://cingel.cz" class="founder-link">Poznat můj příběh &rarr;</a>

        <FounderAudioPlayer
          src="/audio/founder-intro.mp3"
          buttonText="▶ Poslechnout úvod (45 s)"
          disclaimerText="Audio je generováno z hlasu zakladatele pro lepší dostupnost obsahu."
        />
      </div>
      <div class="founder-image-wrapper">
        <img src="/images/tatka-pise.webp" alt="Jaroslav Cingel" class="founder-image" />
      </div>
    </div>
  </section>

  <!-- Statistics Section -->
  <section class="stats-section animate-on-scroll">
    <div class="container stats-container">
      <div class="stat-item">
        <div class="stat-number" data-target="15">0</div>
        <div class="stat-label">let v byznysu</div>
      </div>
      <div class="stat-item">
        <div class="stat-number" data-target="3">0</div>
        <div class="stat-label">kontinenty</div>
      </div>
      <div class="stat-item">
        <div class="stat-number" data-target="24">0</div>
        <div class="stat-label">/7 podpora</div>
      </div>
    </div>
  </section>

  <!-- Services Section -->
  <section id="services" class="section-services animate-on-scroll">
    <div class="container">
      <h2 class="section-title">Naše služby</h2>
      <div class="services-grid">
        {services.map((service) => {
          const slug = service.id.replace(/\.md$/, '');

          let spanClass = 'span-1';
          if (slug === 'analyza-dna' || slug === 'expatriace-viza') {
            spanClass = 'span-2';
          } else if (slug === 'online-kurzy') {
            spanClass = 'span-3';
          }

          const cardClass = `service-card ${spanClass}`;

          return (
          <a href={`/cs/sluzby/${slug}`} class={cardClass}>
            <div class="card-media">
                <img src={service.data.image || "/images/mapa-svetabusines.webp"} alt={service.data.title} class="service-image" />
            </div>
            <h3>{service.data.title}</h3>
            <p>{service.data.description.length > 150 ? service.data.description.slice(0, 150) + '...' : service.data.description}</p>
          </a>
        )})}
      </div>
    </div>
  </section>
</Layout>

<style>
  /* Hero Section */
  .hero {
    background: linear-gradient(135deg, var(--color-text) 0%, #1e293b 100%);
    color: white;
    padding: 6rem 0;
    text-align: center;
  }

  .hero-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
    padding-left: 1.5rem; /* Ensure padding on mobile */
    padding-right: 1.5rem;
  }

  .hero h1 {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: white;
    max-width: 900px;
    line-height: 1.1;
  }

  .hero .subtitle {
    font-size: 1.25rem;
    color: #cbd5e1; /* Slate 300 */
    max-width: 600px;
    margin-bottom: 1.5rem;
  }

  .cta-button {
    background-color: var(--color-accent);
    color: white;
    padding: 0.75rem 2rem;
    border-radius: 9999px; /* Rounded pill */
    font-weight: 600;
    font-size: 1.125rem;
    transition: transform 0.2s ease, background-color 0.2s ease;
    display: inline-block;
  }

  .cta-button:hover {
    background-color: var(--color-accent-hover);
    transform: translateY(-2px);
    color: white;
  }

  /* Founder Section */
  .founder-section {
    padding: 8rem 0;
    background-color: var(--color-bg);
  }

  .founder-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    align-items: center;
  }

  .section-title-left {
    font-size: 2.5rem;
    margin-bottom: 1.5rem;
    position: relative;
    padding-bottom: 1rem;
    text-align: left;
  }

  .section-title-left::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    width: 60px;
    height: 4px;
    background-color: var(--color-accent);
    border-radius: 2px;
  }

  .founder-bio {
    font-size: 1.25rem;
    line-height: 1.6;
    color: #d97706; /* Amber 600 */
    margin-bottom: 2rem;
  }

  .founder-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--color-accent);
    border: 2px solid var(--color-accent);
    padding: 0.75rem 1.5rem;
    border-radius: 9999px;
    transition: all 0.2s ease;
  }

  .founder-link:hover {
    background-color: var(--color-accent);
    color: white;
  }

  .founder-image-wrapper {
    position: relative;
  }

  .founder-image {
    width: 100%;
    height: auto;
    border-radius: 12px;
    box-shadow: var(--shadow-card);
    max-width: 400px;
    display: block;
    margin: 0 auto;
    aspect-ratio: 3/4;
    object-fit: cover;
  }

  /* Stats Section */
  .stats-section {
    padding: 3rem 0;
    background-color: var(--color-accent);
    color: white;
  }

  .stats-container {
    display: flex;
    justify-content: space-around;
    align-items: center;
    flex-wrap: wrap;
    gap: 2rem;
  }

  .stat-item {
    text-align: center;
  }

  .stat-number {
    font-size: 3.5rem;
    font-weight: 800;
    font-family: 'Plus Jakarta Sans', sans-serif;
    line-height: 1;
    margin-bottom: 0.5rem;
  }

  .stat-label {
    font-size: 1.125rem;
    font-weight: 500;
    opacity: 0.9;
  }

  /* Services Section */
  .section-services {
    padding: 5rem 0;
    background-color: var(--color-bg-alt);
  }

  .section-title {
    text-align: center;
    font-size: 2.5rem;
    margin-bottom: 3rem;
    position: relative;
    padding-bottom: 1rem;
  }

  .section-title::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 4px;
    background-color: var(--color-accent);
    border-radius: 2px;
  }

  .services-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 24px;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
  }

  .service-card {
    background: var(--color-bg-card);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    padding: 2rem;
    border-radius: 12px;
    box-shadow: var(--card-shadow);
    transition: transform 0.1s ease-out, box-shadow 0.3s ease, border-color 0.3s ease;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    height: 100%;
    border: var(--card-border);
    transform-style: preserve-3d;
    perspective: 1000px;
    /* Removed max-width: 350px to allow filling the grid cell, especially for spans */
    width: 100%;
    text-decoration: none;
    color: inherit;
  }

  .span-2 {
      grid-column: span 2;
  }

  .span-3 {
      grid-column: span 3;
  }

  .service-card:hover {
    box-shadow: 0 30px 40px -10px rgba(0, 0, 0, 0.2), 0 20px 20px -10px rgba(0, 0, 0, 0.1);
    z-index: 10;
    border-color: var(--color-accent);
  }

  .card-media {
    width: 100%;
    height: 200px;
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 1.5rem;
  }

  .service-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .service-card:hover .service-image {
    transform: scale(1.05);
  }

  .service-card h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--color-text);
  }

  .service-card p {
    color: var(--color-text-light);
    flex-grow: 1;
    margin-bottom: 1.5rem;
    line-height: 1.6;
    font-size: 0.9rem;
  }

  /* Responsive Adjustments */
  @media (max-width: 1024px) {
     /* The user specifically asked for 3 columns and specific layout.
        However, usually 1024px is too small for 3 columns if cards are wide.
        But the user's prompt didn't specify tablet behavior other than <768px.
        I will leave the 2-column fallback for tablet (1024px) as it was before,
        but make sure spans are handled gracefully or just allow the grid to flow.
        Actually, let's stick to the user's specific CSS which only mentioned max-width 768px.
        Wait, the user's CSS instruction was:
        "@media (max-width: 768px) { .span-2, .span-3 { grid-column: span 1; } }"
        It didn't mention 1024px.
        If I remove the 1024px query, it will stay 3 columns down to 768px.
        I'll keep it simple and follow the user's explicit CSS for mobile.
     */
  }

  @media (max-width: 768px) {
    .services-grid {
        grid-template-columns: 1fr;
    }

    .span-2, .span-3 {
        grid-column: span 1;
    }

    .hero {
      padding: 4rem 0; /* Adjusted padding */
    }

    .hero h1 {
      font-size: 2rem; /* Reduced font size for mobile */
    }

    .hero .subtitle {
      font-size: 1.1rem;
    }

    .founder-content {
      grid-template-columns: 1fr;
      gap: 2rem;
      text-align: center;
    }

    .section-title-left {
      text-align: center;
    }

    .section-title-left::after {
      left: 50%;
      transform: translateX(-50%);
    }

    .founder-link {
        margin: 0 auto;
    }

    .section-title {
      font-size: 2rem;
    }

    /* Mobile: 1 column */
    /* .services-grid override removed to respect auto-fit */
  }
</style>
