---
import { ui, defaultLang } from '../i18n/ui';
import { getTranslatedPath } from '../i18n/utils';

const { lang = defaultLang } = Astro.props;
const year = new Date().getFullYear();

const t = ui[lang] || ui[defaultLang];

// Helper for links (replaced by getTranslatedPath)
const getLink = (path) => getTranslatedPath(path, lang);
---
<footer>
  <!-- Founder Medallion Section -->
  <div class="founder-medallion">
    <div class="container medallion-content">
      <div class="medallion-image-wrapper">
         <img src="/images/tatka_knihovna.webp" alt="Jaroslav Cingel" class="medallion-image" />
      </div>
      <div class="medallion-text">
        <p class="quote">{t.footer.quote}</p>
        <div class="signature">
          <span class="name">Jaroslav Cingel</span>
          <span class="title">CEO, Progressivo Corp.</span>
        </div>
        <a href="mailto:jaroslav@cingel.cz" class="contact-link">{t.buttons.write_to_me}</a>
      </div>
    </div>
  </div>

  <div class="footer-container">
    <!-- Column A: Navigation -->
    <div class="footer-col nav-col">
      <h3>{t.footer.nav_title}</h3>
      <nav>
        <ul>
          <li><a href={getLink('/o-nas')}>{t.nav.about}</a></li>
          <li><a href={getLink('/#services')}>{t.nav.services}</a></li>
          <li><a href={getLink('/blog')}>{t.nav.blog}</a></li>
          <li><a href={getLink('/kontakt')}>{t.nav.contact}</a></li>
        </ul>
      </nav>
    </div>

    <!-- Column B: Network & Ecosystem -->
    <div class="footer-col network-col">
      <h3>{t.footer.network_title}</h3>
      <nav>
        <ul>
          <li>
            <a href="https://itutoring.cz" target="_blank" rel="noopener noreferrer">
              iTutoring.cz <span class="icon-external" aria-hidden="true">↗</span>
            </a>
          </li>
          <li>
            <a href="https://jerry.cingel.cz" target="_blank" rel="noopener noreferrer">
              jerry.cingel.cz <span class="icon-external" aria-hidden="true">↗</span>
            </a>
          </li>
          <li>
            <a href="https://bailamos.cz" target="_blank" rel="noopener noreferrer">
              bailamos.cz <span class="icon-external" aria-hidden="true">↗</span>
            </a>
          </li>
          <li>
            <a href="https://panama.bailamos.cz" target="_blank" rel="noopener noreferrer">
              panama.bailamos.cz <span class="icon-external" aria-hidden="true">↗</span>
            </a>
          </li>
          <li>
            <span class="domitoo-item" aria-label="Interní projekt DomiToo">
              <span class="domitoo-logo">
                DomiToo
                <span class="domitoo-hit"></span>
              </span>
              <svg class="icon-lock" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
            </span>
          </li>
          <li>
            <a href="https://progressivo.eu" target="_blank" rel="noopener noreferrer">
              {t.footer.link_webs} <span class="icon-external" aria-hidden="true">↗</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>

    <!-- Column D: Trust & Legal -->
    <div class="footer-col trust-col">
      <h3>{t.footer.trust_title}</h3>
      <nav>
        <ul>
          <li>
             <a href="https://www.linkedin.com/in/jaroslavcingel/" target="_blank" rel="noopener noreferrer">
               LinkedIn <span class="icon-external" aria-hidden="true">↗</span>
             </a>
          </li>
          <li><a href={getLink('/gdpr')}>{t.footer.link_gdpr}</a></li>
          <li><a href={getLink('/obchodni-podminky')}>{t.footer.link_terms}</a></li>
          <li><a href={getLink('/smluvni-podminky')}>{t.footer.link_contract}</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <div class="footer-bottom">
    <p>&copy; {year} Progressivo Corp.</p>
  </div>
</footer>

<script>
  // DomiToo Easter Egg Logic
  document.addEventListener('astro:page-load', () => {
      // Logic adjusted for the overlay technique
      const dTrigger = document.querySelector('.domitoo-hit');
      if (!dTrigger) return;

      const redirectUrl = 'https://domitoo.progressivo.eu';
      let touchTimer;
      const longPressDuration = 600;

      const activateEasterEgg = () => {
          window.location.href = redirectUrl;
      };

      // Desktop Double Click
      dTrigger.addEventListener('dblclick', activateEasterEgg);

      // Mobile Long Press
      const startPress = (e) => {
          touchTimer = setTimeout(() => {
              activateEasterEgg();
          }, longPressDuration);
      };

      const cancelPress = () => {
          if (touchTimer) clearTimeout(touchTimer);
      };

      dTrigger.addEventListener('touchstart', startPress, { passive: true });
      dTrigger.addEventListener('touchend', cancelPress);
      dTrigger.addEventListener('touchmove', cancelPress);
      dTrigger.addEventListener('mousedown', startPress);
      dTrigger.addEventListener('mouseup', cancelPress);
      dTrigger.addEventListener('mouseleave', cancelPress);

      // Prevent default context menu on long press
      dTrigger.addEventListener('contextmenu', (e) => {
          e.preventDefault();
      });
  });
</script>

<style>
  footer {
    position: relative;
    z-index: 10;
    /* Removed background-color to respect hygiene rules, but kept existing layout structure.
       Actually, user said "žádná změna pozadí", which likely means keep whatever background was there or implied by the "paper feel".
       The previous footer had var(--color-bg-alt). I will keep it to ensure it doesn't look broken,
       but user said "žádný tmavý blok". --color-bg-alt is light in light mode (#e7e5e4). */
    background-color: var(--color-bg-alt);
    padding-top: 0;
    border-top: 1px solid var(--color-border);
    margin-top: 4rem;
  }

  /* Founder Medallion - Unchanged */
  .founder-medallion {
    background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
    color: white;
    padding: 3rem 0;
    margin-bottom: 4rem;
  }

  .medallion-content {
    display: flex;
    align-items: center;
    gap: 2rem;
    justify-content: center;
  }

  .medallion-image-wrapper {
      width: 130px;
      height: 130px;
      flex-shrink: 0;
  }

  .medallion-image {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--color-accent);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
  }

  .medallion-text {
      max-width: 600px;
  }

  .quote {
      font-style: italic;
      color: #cbd5e1;
      margin: 0 0 1rem;
      font-size: 1.1rem;
      line-height: 1.6;
  }

  .signature {
      display: flex;
      flex-direction: column;
      gap: 0;
      margin-bottom: 1rem;
  }

  .signature .name {
      color: var(--color-accent);
      font-weight: 700;
      font-size: 1rem;
      line-height: 1.3;
  }

  .signature .title {
      color: var(--color-accent);
      font-size: 0.875rem;
      font-weight: 500;
      line-height: 1.3;
  }

  .contact-link {
      display: inline-block;
      margin-top: 0.5rem;
      color: white;
      text-decoration: underline;
      text-decoration-color: var(--color-accent);
      text-underline-offset: 4px;
      font-size: 0.9rem;
  }

  .contact-link:hover {
      color: var(--color-accent);
  }

  /* Fat Footer Layout */
  .footer-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
  }

  .footer-col h3 {
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 600;
    margin-bottom: 1.5rem;
    color: var(--color-text);
    opacity: 0.7;
  }

  .footer-col nav ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .footer-col nav a, .domitoo-item {
    text-decoration: none;
    color: var(--color-text-light);
    font-size: 0.95rem;
    transition: color 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
  }

  .footer-col nav a:hover {
    color: var(--color-accent);
  }

  /* DomiToo Styles */
  .domitoo-item {
      cursor: default; /* Looks like text */
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
  }

  .domitoo-logo {
      position: relative;
      display: inline-block;
  }

  .domitoo-hit {
      position: absolute;
      left: 0;
      top: 0;
      width: 0.8em;
      height: 100%;
      cursor: pointer;
      z-index: 10;
  }

  /* Icons */
  .icon-external {
      font-size: 0.7em;
      opacity: 0.6;
      margin-left: 2px;
  }

  .icon-lock {
      margin-left: 4px;
      opacity: 0.6;
      width: 12px;
      height: 12px;
  }

  /* Footer Bottom */
  .footer-bottom {
    max-width: 1200px;
    margin: 4rem auto 0;
    padding: 1.5rem 1rem 0;
    border-top: 1px solid var(--color-border); /* Subtle line */
    text-align: center;
    color: var(--color-text-light);
    font-size: 0.8rem;
    opacity: 0.6;
    padding-bottom: 2rem;
  }

  .footer-bottom p {
    margin: 0;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .footer-container {
      grid-template-columns: 1fr; /* Stacked columns */
      gap: 3rem;
      text-align: left; /* Keep aligned left for list readibility usually, but audit said stack */
    }

    /* Medallion responsive styles from original file */
    .medallion-content {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
    }

    .medallion-image-wrapper {
        width: 110px;
        height: 110px;
    }
  }

  @media (max-width: 480px) {
    .medallion-image-wrapper {
        width: 95px;
        height: 95px;
    }

    .footer-container {
        padding-left: 1.5rem; /* Little more breathing room on mobile if left aligned */
    }
  }
</style>
