---
---

<section class="editorial-time-signal" aria-label="Global Operations Time Zones">
  <div class="container signal-content">
    <!-- 1) Primary Brand Statement -->
    <div class="brand-statement">
      BUILT ON 15+ YEARS OF EXPERIENCE — WORKING ACROSS TIME ZONES
    </div>

    <!-- 2) Secondary Time Display -->
    <div class="time-display">
      <div class="time-group">
        <span class="time-entry">PANAMA <span class="time-value" data-tz="America/Panama">--:--</span></span>
        <span class="separator">—</span>
        <span class="time-entry">PRAGUE <span class="time-value" data-tz="Europe/Prague">--:--</span></span>
      </div>
      <span class="separator desktop-only">—</span>
      <div class="time-group">
        <span class="time-entry">LONDON <span class="time-value" data-tz="Europe/London">--:--</span></span>
        <span class="separator">—</span>
        <span class="time-entry">MOSCOW <span class="time-value" data-tz="Europe/Moscow">--:--</span></span>
      </div>
    </div>

    <!-- 3) Micro Heartbeat Line -->
    <div class="heartbeat-line"></div>
  </div>
</section>

<script>
  // Use a unique property on window to store our interval ID to prevent leaks
  const INTERVAL_KEY = '__editorialTimeSignalInterval';

  function initTimeSignal() {
    // Clear any existing interval first (just in case)
    if (window[INTERVAL_KEY]) {
      clearInterval(window[INTERVAL_KEY]);
      window[INTERVAL_KEY] = null;
    }

    const timeValues = document.querySelectorAll('.time-value');
    if (timeValues.length === 0) return;

    const formatters = {};

    function updateTime() {
      const now = new Date();

      timeValues.forEach(el => {
        const tz = el.getAttribute('data-tz');
        if (!tz) return;

        if (!formatters[tz]) {
          formatters[tz] = new Intl.DateTimeFormat('en-US', {
            timeZone: tz,
            hour: '2-digit',
            minute: '2-digit',
            hour12: false
          });
        }

        try {
            el.textContent = formatters[tz].format(now);
            el.style.opacity = '1';
        } catch (e) {
            console.error('Time formatting error', e);
        }
      });
    }

    // Initial update
    updateTime();

    // Align with the minute start
    const now = new Date();
    const msToNextMinute = (60 - now.getSeconds()) * 1000 - now.getMilliseconds() + 100;

    const timeoutId = setTimeout(() => {
        updateTime();
        // Set interval for 1 minute
        window[INTERVAL_KEY] = setInterval(updateTime, 60000);
    }, msToNextMinute);

    // Also store the timeout ID temporarily if needed, but for simplicity
    // we assume the timeout is short enough or we just clear the interval on next load.
    // Ideally we track the timeout too if the user navigates away VERY quickly.

    // Better cleanup logic for Astro View Transitions:
    // When the page unloads or before new page load, we should clear everything.
    // However, initTimeSignal is called on 'astro:page-load'.
    // The previous interval is cleared at the start of initTimeSignal.

    // We can also attach a listener for 'astro:before-preparation' or similar if we want to be pedantic,
    // but clearing at start of function is robust enough for SPA navigation.
  }

  document.addEventListener('astro:page-load', initTimeSignal);
</script>

<style>
  .editorial-time-signal {
    padding: 2rem 0 4rem 0; /* Adjust padding as needed for "directly under hero" */
    background-color: transparent;
    font-family: 'Manrope', sans-serif;
    text-align: center;
    position: relative;
    z-index: 10;
  }

  .signal-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    max-width: 1000px;
  }

  /* 1) Primary Line */
  .brand-statement {
    font-size: 0.875rem; /* 14px - "malá / editoriální" */
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em; /* "tracking: jemně zvýšený" */
    color: var(--color-text);
    line-height: 1.4;
  }

  /* 2) Secondary Line */
  .time-display {
    display: flex;
    flex-direction: column; /* Mobile first: 2x2 grid approach via rows */
    align-items: center;
    gap: 0.5rem;
    font-size: 0.75rem; /* Smaller than primary */
    font-weight: 500;
    color: var(--color-text);
    opacity: 0.7; /* "60–70% opacity" */
    font-variant-numeric: tabular-nums; /* Critical */
  }

  .time-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .time-entry {
    white-space: nowrap;
    text-transform: uppercase;
  }

  .separator {
    margin: 0 0.25rem;
    opacity: 0.5;
  }

  .desktop-only {
    display: none;
  }

  /* 3) Heartbeat Line */
  .heartbeat-line {
    height: 1px;
    width: 60px; /* Start small, user said "50-60% width" - let's adjust */
    width: 55%;
    background-color: var(--color-accent);
    margin-top: 1.5rem;
    opacity: 0.4; /* "30-50%" */
    animation: heartbeat 1.5s ease-in-out infinite alternate;
  }

  @keyframes heartbeat {
    0% {
      opacity: 0.3;
      transform: scaleX(0.98);
    }
    100% {
      opacity: 0.5;
      transform: scaleX(1.02);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .heartbeat-line {
      animation: none;
      opacity: 0.4;
    }
  }

  /* Desktop Styles (>= 640px) */
  @media (min-width: 640px) {
    .time-display {
      flex-direction: row;
      gap: 0.5rem;
    }

    .desktop-only {
      display: inline;
    }
  }

  /* Dark mode tweaks if necessary - inherits variables, so should be fine */
</style>
